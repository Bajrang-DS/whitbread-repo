var h=Object.defineProperty;var d=(i,e,t)=>e in i?h(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var c=(i,e,t)=>(d(i,typeof e!="symbol"?e+"":e,t),t);import{r as m}from"./index-0ef72bf1.js";import{g as l,a as f,H as k,C as w,s as _,c as y}from"./PhotoSlider-0692fb7a.js";import{j as b}from"./header-afda08f2.js";const u=i=>{var t;return l().name==="browser"&&i===((t=window==null?void 0:window.location)==null?void 0:t.hostname)};function T(i){var e=new k;return new f(i,e)}class P{constructor(e,t){c(this,"_optedIn");c(this,"_conversionTrackingEnabled",!1);c(this,"_cookieManager");c(this,"_analyticsReporter");c(this,"_pageViewFired",!1);c(this,"_enableDebugging",!1);this.templateData=e,this._optedIn=!t,this.makeReporter(),this.pageView()}calculatePageType(){var r,n,o,s;const e=!!((n=(r=this.templateData.document)==null?void 0:r.__)!=null&&n.staticPage),t=!!((s=(o=this.templateData.document)==null?void 0:o.__)!=null&&s.entityPageSet);let a;if(e)a={name:"static",staticPageId:this.templateData.document.__.name};else if(t)a={name:"entity",pageSetId:this.templateData.document.__.name,id:this.templateData.document.uid};else throw new Error("invalid document type");return a}makeReporter(){var t,a,r,n;if(l().name!=="browser"||!this._optedIn)return;const e=u((a=(t=this.templateData)==null?void 0:t.document)==null?void 0:a.siteInternalHostName)||u((n=(r=this.templateData)==null?void 0:r.document)==null?void 0:n.siteDomain);this._analyticsReporter=T({businessId:this.templateData.document.businessId,pageType:this.calculatePageType(),pageUrl:window.location.href,production:e,referrer:document.referrer,siteId:this.templateData.document.siteId}),this.setDebugEnabled(this._enableDebugging)}canTrack(){return l().name==="browser"&&this._optedIn&&!!this._analyticsReporter}setupConversionTracking(){var e;this._cookieManager=new w,(e=this._analyticsReporter)==null||e.setConversionTrackingEnabled(!0,this._cookieManager.setAndGetYextCookie())}enableTrackingCookie(){this._conversionTrackingEnabled=!0,this.canTrack()&&this.setupConversionTracking()}identify(e){var t;this.canTrack()&&((t=this._analyticsReporter)==null||t.setVisitor(e))}async optIn(){this._optedIn=!0,this.makeReporter(),this._conversionTrackingEnabled&&!this._cookieManager&&this.setupConversionTracking(),this._pageViewFired||await this.pageView()}async pageView(){var e;if(!this.canTrack())return Promise.resolve(void 0);await((e=this._analyticsReporter)==null?void 0:e.pageView()),this._pageViewFired=!0}async track(e,t){var a;if(!this.canTrack())return Promise.resolve();await((a=this._analyticsReporter)==null?void 0:a.track({eventType:_(e)},t))}setDebugEnabled(e){var t;this._enableDebugging=e,(t=this._analyticsReporter)==null||t.setDebugEnabled(e)}trackClick(e,t){return a=>{if(!this.canTrack())return Promise.resolve();if(a.target===null||a.defaultPrevented)return this.track(e,t);const r=a.target;if(r.href===null||r.href===void 0)return this.track(e,t);const n=new URL(r.href);if(n.protocol==="mailto:"||n.protocol==="tel:"||n.protocol==="javascript:"||n.hostname===window.location.hostname)return this.track(e,t);if(r.target&&!r.target.match(/^_(self|parent|top)$/i)||a.ctrlKey||a.shiftKey||a.metaKey)return this.track(e,t);a.preventDefault();const s=()=>{window.location.assign(n)},g=new Promise(p=>{setTimeout(()=>{p()},1e3)});return Promise.race([this.track(e,t),g]).then(s)}}}function E(i){const{children:e,requireOptIn:t,enableTrackingCookie:a,enableDebugging:r,templateData:n}=i,o=m.exports.useRef(null);o.current===null&&(o.current=new P(n,t));const s=o.current;return a&&s.enableTrackingCookie(),(r||D())&&s.setDebugEnabled(!0),b(y.Provider,{value:s,children:e})}function D(){return l().name!=="browser"||typeof window===void 0?!1:!!new URL(window.location.href).searchParams.get("xYextDebug")}export{E as A};
